pipeline {
    agent any

    stages {
        stage('Test Stage') {
            steps {
                echo 'This is a test stage.'
            }
        }
    }

    post {
        always {
            script {
                def logFile = "${env.WORKSPACE}/pipeline-log.txt"
                writeFile file: logFile, text: currentBuild.rawBuild.getLog().join("\n")
            }
            emailext attachmentsPattern: 'pipeline-log.txt',
                     to: "angelo.mouzouris@gmail.com",
                     subject: "Test Email with Attached Log",
                     body: "The pipeline has completed. Please find the log attached."
        }
    }
}
